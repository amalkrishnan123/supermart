{% extends "navbar.html" %}
{% load static %}

{% block search %}
<div class="search-wrap">
    <form method="get" class="search-form">
        <input type="text"
               name="search"
               class="search-input"
               placeholder="Search products"
               value="{{ request.GET.search }}">
        <button type="submit" class="search-btn">
            <i class="bi bi-search"></i>
        </button>
    </form>

    <form method="get">
        <button type="submit" class="btn btn-link clear-btn">
            Clear filters
        </button>
    </form>
</div>
{% endblock %}

{% block username %}
<span class="username-badge">
    {{ request.user.username|upper }}
</span>
{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/sidebar.css' %}">

<style>
/* ===== RESET ===== */
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    overflow-x: hidden;
}

/* ===== BACKGROUND ===== */
body {
    min-height: 100vh;
    background-image: url("{% static 'images/bg1.jpg' %}");
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    background-attachment: fixed;
}

/* ===== PRODUCT AREA (FIXED) ===== */
.product-area {
    padding-left: 260px;
    padding-right: 30px;
    padding-top: 30px;
    width: 100%;
    min-height: 100vh;
    margin-top:80px;
}

/* ===== GRID ===== */
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 24px;
}

/* ===== CARD ===== */
.product-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 6px 18px rgba(0,0,0,.15);
    transition: .25s ease;
    overflow: hidden;
}

.product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 14px 32px rgba(0,0,0,.25);
}

.product-img {
    height: 190px;
    object-fit: contain;
    padding: 16px;
    background: #fafafa;
}

.product-title {
    font-size: .95rem;
    font-weight: 600;
}

.product-meta {
    font-size: .8rem;
    color: #6c757d;
}

/* ===== WISHLIST ===== */
.wishlist-btn {
    background: rgba(255,255,255,.95);
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0,0,0,.2);
}

/* ===== PAGINATION ===== */
.pagination-warning .page-link {
    background: #ffc107;
    color: #000;
    border: none;
    margin: 0 4px;
    border-radius: 8px;
    font-weight: 500;
}

.pagination-warning .page-item.active .page-link {
    background: #000;
    color: #ffc107;
}

.pagination-warning .page-item.disabled .page-link {
    background: #ddd;
    color: #999;
}

/* ===== MOBILE ===== */
@media (max-width: 992px) {
    .product-area {
        padding-left: 0;
        padding-right: 15px;
    }
}
</style>

<!-- ===== PAGE ===== -->
<div class="page-wrapper">

    <!-- ===== SIDEBAR ===== -->
    <div class="filter-sidebar">
        <form method="get">

            <h5>Filter Products</h5>

            <label>Category</label>
            <select name="category" class="form-select mb-2">
                <option value="">All</option>
                {% for i in cat %}
                <option value="{{ i.id }}"
                    {% if request.GET.category == i.id|stringformat:"s" %}selected{% endif %}>
                    {{ i.name }}
                </option>
                {% endfor %}
            </select>

            <label>Brand</label>
            <select name="brand" class="form-select mb-2">
                <option value="">All</option>
                {% for i in brand %}
                <option value="{{ i.id }}"
                    {% if request.GET.brand == i.id|stringformat:"s" %}selected{% endif %}>
                    {{ i.name }}
                </option>
                {% endfor %}
            </select>

            <label>Price</label>
            <select name="price" class="form-select mb-3">
                <option value="">All</option>
                <option value="1" {% if request.GET.price == '1' %}selected{% endif %}>₹500 – ₹1500</option>
                <option value="2" {% if request.GET.price == '2' %}selected{% endif %}>₹1500 – ₹2500</option>
                <option value="3" {% if request.GET.price == '3' %}selected{% endif %}>₹2500 – ₹3500</option>
                <option value="4" {% if request.GET.price == '4' %}selected{% endif %}>Above ₹3500</option>
            </select>

            <button class="btn btn-warning w-100 fw-semibold">
                Apply Filters
            </button>
        </form>
    </div>

    <!-- ===== PRODUCTS ===== -->
    <div class="product-area ">

        <div class="product-grid">

            {% for i in product %}
            <div class="card product-card position-relative">

                <a href="{% url 'toggle_wishlist' i.id %}"
                   class="btn wishlist-btn position-absolute top-0 end-0 m-2">
                    {% if i.id in wishlist_ids %}
                        <i class="bi bi-heart-fill text-danger"></i>
                    {% else %}
                        <i class="bi bi-heart"></i>
                    {% endif %}
                </a>

                <a href="{% url 'product_desc' i.id %}" class="text-decoration-none text-dark">
                    <img src="{{ i.image.url }}" class="product-img w-100">

                    <div class="card-body">
                        <div class="product-title">{{ i.name|upper }}</div>
                        <div class="product-meta">{{ i.category }} · {{ i.brand }}</div>
                        <div class="fw-bold mt-2">₹ {{ i.price }}</div>

                        {% if i.stock > 10 %}
                            <span class="badge bg-success mt-2">In Stock</span>
                        {% elif i.stock > 0 %}
                            <span class="badge bg-warning text-dark mt-2">Limited</span>
                        {% else %}
                            <span class="badge bg-danger mt-2">Out of Stock</span>
                        {% endif %}
                    </div>
                </a>
            </div>
            {% empty %}
            <p class="text-center text-light mt-5">No products found.</p>
            {% endfor %}

        </div>

        <!-- ===== PAGINATION ===== -->
        {% if product.paginator.num_pages > 1 %}
        <div class="d-flex justify-content-center mt-5">
            <ul class="pagination pagination-warning">

                {% if product.has_previous %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ product.previous_page_number }}{% for k,v in request.GET.items %}{% if k != 'page' %}&{{ k }}={{ v }}{% endif %}{% endfor %}">
                        Prev
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled"><span class="page-link">Prev</span></li>
                {% endif %}

                {% for num in product.paginator.page_range %}
                    {% if num == product.number %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                    <li class="page-item">
                        <a class="page-link"
                           href="?page={{ num }}{% for k,v in request.GET.items %}{% if k != 'page' %}&{{ k }}={{ v }}{% endif %}{% endfor %}">
                           {{ num }}
                        </a>
                    </li>
                    {% endif %}
                {% endfor %}

                {% if product.has_next %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ product.next_page_number }}{% for k,v in request.GET.items %}{% if k != 'page' %}&{{ k }}={{ v }}{% endif %}{% endfor %}">
                        Next
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled"><span class="page-link">Next</span></li>
                {% endif %}

            </ul>
        </div>
        {% endif %}

    </div>

</div>

{% endblock %}
