{% extends "navbar.html" %}
{% load static %}

{% block search %}
<div class="search-wrap">
    <form method="get" class="search-form">
        <input type="text"
               name="search"
               class="search-input"
               placeholder="Search products"
               value="{{ request.GET.search }}">
        <button type="submit" class="search-btn">
            <i class="bi bi-search"></i>
        </button>
    </form>

    <form method="get">
        <button type="submit" class="btn btn-link clear-btn">
            Clear filters
        </button>
    </form>
</div>
{% endblock %}

{% block username %}
<span class="username-badge">
    {{ request.user.username|upper }}
</span>
{% endblock %}

{% block content %}

<style>
/* ===== RESET ===== */
* { box-sizing: border-box; }
html, body { margin: 0; padding: 0; overflow-x: hidden; }

/* ===== BACKGROUND ===== */
body {
    min-height: 100vh;
    background: url("{% static 'images/bg1.jpg' %}") center / cover no-repeat fixed;
}

/* ===== PAGE WRAPPER ===== */
.page-wrapper {
    margin-top: 80px;
    padding: 0 20px;
}

/* ===== FILTER BAR ===== */
.filter-bar {
    background: rgba(0,0,0,.75);
    padding: 16px;
    border-radius: 14px;
    margin-bottom: 28px;
}

.filter-bar h5 {
    color: #ffc107;
    font-weight: 700;
    margin-bottom: 14px;
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 14px;
}

.filter-bar label {
    color: #e5e7eb;
    font-size: .85rem;
}

.filter-bar .form-select {
    background: #020617;
    color: #fff;
    border: 1px solid rgba(255,255,255,.2);
}

.filter-bar .form-select:focus {
    border-color: #ffc107;
    box-shadow: none;
}

.filter-bar button {
    background: #ffc107;
    color: #000;
    font-weight: 700;
    border: none;
}

/* ===== PRODUCT GRID ===== */
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 26px;
}

/* ===== PRODUCT CARD ===== */
.product-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 6px 18px rgba(0,0,0,.15);
    transition: .25s ease;
    overflow: hidden;
}

.product-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 14px 32px rgba(0,0,0,.25);
}

.product-img {
    height: 190px;
    object-fit: contain;
    padding: 16px;
    background: #fafafa;
}

/* ===== PAGINATION ===== */
.pagination-warning .page-link {
    background: #ffc107;
    color: #000;
    border: none;
    margin: 0 4px;
    border-radius: 8px;
    font-weight: 500;
}

.pagination-warning .page-item.active .page-link {
    background: #000;
    color: #ffc107;
}

/* ===== MOBILE ===== */
@media (max-width: 576px) {
    .product-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<div class="page-wrapper">

    <!-- ===== FILTER BAR ===== -->
    <div class="filter-bar">
        <form method="get">

            <h5>Filter Products</h5>

            <div class="filter-grid">

                <div>
                    <label>Category</label>
                    <select name="category" class="form-select">
                        <option value="">All</option>
                        {% for i in cat %}
                        <option value="{{ i.id }}"
                            {% if request.GET.category == i.id|stringformat:"s" %}selected{% endif %}>
                            {{ i.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label>Brand</label>
                    <select name="brand" class="form-select">
                        <option value="">All</option>
                        {% for i in brand %}
                        <option value="{{ i.id }}"
                            {% if request.GET.brand == i.id|stringformat:"s" %}selected{% endif %}>
                            {{ i.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label>Price</label>
                    <select name="price" class="form-select">
                        <option value="">All</option>
                        <option value="1" {% if request.GET.price == '1' %}selected{% endif %}>₹500 – ₹1500</option>
                        <option value="2" {% if request.GET.price == '2' %}selected{% endif %}>₹1500 – ₹2500</option>
                        <option value="3" {% if request.GET.price == '3' %}selected{% endif %}>₹2500 – ₹3500</option>
                        <option value="4" {% if request.GET.price == '4' %}selected{% endif %}>Above ₹3500</option>
                    </select>
                </div>

                <div class="d-flex align-items-end">
                    <button class="btn w-100">Apply Filters</button>
                </div>

            </div>
        </form>
    </div>

    <!-- ===== PRODUCTS ===== -->
    <div class="product-grid">

        {% for i in product %}
        <div class="card product-card position-relative">

            <a href="{% url 'toggle_wishlist' i.id %}"
               class="btn wishlist-btn position-absolute top-0 end-0 m-2">
                {% if i.id in wishlist_ids %}
                    <i class="bi bi-heart-fill text-danger"></i>
                {% else %}
                    <i class="bi bi-heart"></i>
                {% endif %}
            </a>

            <a href="{% url 'product_desc' i.id %}" class="text-decoration-none text-dark">
                <img src="{{ i.image.url }}" class="product-img w-100">
                <div class="card-body">
                    <div class="fw-bold">{{ i.name|upper }}</div>
                    <div class="text-muted small">{{ i.category }} · {{ i.brand }}</div>
                    <div class="fw-bold mt-2">₹ {{ i.price }}</div>
                </div>
            </a>

        </div>
        {% empty %}
        <p class="text-center text-light mt-5">No products found.</p>
        {% endfor %}

    </div>

    <!-- ===== PAGINATION (FIXED) ===== -->
    {% if product.paginator.num_pages > 1 %}
    <div class="d-flex justify-content-center mt-5 mb-4">
        <ul class="pagination pagination-warning">

            {% for num in product.paginator.page_range %}
            <li class="page-item {% if num == product.number %}active{% endif %}">
                <a class="page-link"
                   href="?page={{ num }}{% for k,v in request.GET.items %}{% if k != 'page' %}&{{ k }}={{ v }}{% endif %}{% endfor %}">
                    {{ num }}
                </a>
            </li>
            {% endfor %}

        </ul>
    </div>
    {% endif %}

</div>

{% endblock %}
